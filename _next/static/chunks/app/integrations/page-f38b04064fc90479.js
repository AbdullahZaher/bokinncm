(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[988],{82906:function(e,t,a){Promise.resolve().then(a.bind(a,85664))},85664:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Q}});var n=a(9268),r=a(86006),s=a(51597),l=a(25428),o=a(31210),i=a(13583),c=a(31211),d=a(81466),u=a(42442),m=a(74745),h=a(38812),f=a(14316),x=a(27110),p=a(26602);let g=r.forwardRef((e,t)=>{let{className:a,value:r,...s}=e;return(0,n.jsx)(x.fC,{ref:t,className:(0,p.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",a),...s,children:(0,n.jsx)(x.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(r||0),"%)")}})})});g.displayName=x.fC.displayName;var y=a(68569),j=a(89423),v=a(23556),w=a(77228),N=a(1816),_=a(98364),b=a(95560),C=a(92317);let S=e=>e?new Date(e).toLocaleString("en-US",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):null;var k=a(43626),E=a(63266),R=a(20311),O=a(70525),U=a(78917);let A=(0,U.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),L=r.forwardRef((e,t)=>{let{className:a,variant:r,...s}=e;return(0,n.jsx)("div",{ref:t,role:"alert",className:(0,p.cn)(A({variant:r}),a),...s})});L.displayName="Alert";let P=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("h5",{ref:t,className:(0,p.cn)("mb-1 font-medium leading-none tracking-tight",a),...r})});P.displayName="AlertTitle";let Z=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,p.cn)("text-sm [&_p]:leading-relaxed",a),...r})});Z.displayName="AlertDescription";var z=a(47861);function I(e){let{open:t,onOpenChange:a,channelName:s,channelId:l,onConnect:o,isLoading:c,isAdditionalUrl:d=!1,isBookingCom:u=!1}=e,m=(0,E.createClientComponentClient)(),[h,f]=(0,r.useState)([]),[x,p]=(0,r.useState)(""),[g,j]=(0,r.useState)(""),[v,w]=(0,r.useState)(null);(0,r.useEffect)(()=>{!async function(){let e=m.from("rooms").select("name").order("name");u?e=e.is("bookingdotcom_xml_url",null):"5"===l?e=e.is("agoda_calendar_url",null):"3"===l?e=e.is("airbnb_calendar_url",null):"2"===l?e=e.is("expedia_calendar_url",null):"4"===l?e=e.is("google_calendar_url",null):"6"===l?e=e.is("tripadvisor_calendar_url",null):"7"===l&&(e=e.is("gathern_calendar_url",null));let{data:t,error:a}=await e;if(a){console.error("Error fetching rooms:",a);return}if(t){let e=t.map(e=>e.name);f(e)}}()},[m,u,l]);let N=async()=>{try{if(!x||!g){console.error("Please fill in all fields");return}if(u&&!g.includes("booking.com")){w("Please enter a valid Booking.com calendar URL");return}if("3"!==l||g.includes("airbnb.com")){if("2"!==l||g.includes("expedia.com")){if("4"!==l||g.includes("calendar.google.com")){if("6"!==l||g.includes("tripadvisor.com")){if("7"===l&&!g.includes("gathern.co")){w("Please enter a valid Gathern calendar URL");return}}else{w("Please enter a valid TripAdvisor calendar URL");return}}else{w("Please enter a valid Google Calendar URL");return}}else{w("Please enter a valid Expedia calendar URL");return}}else{w("Please enter a valid Airbnb calendar URL");return}if(w(null),u){let{data:e,error:t}=await m.from("rooms").select("id").eq("name",x).single();if(t)throw console.error("Error fetching room:",t),t;if(!e){console.error("Room not found");return}let{error:a}=await m.from("rooms").update({bookingdotcom_xml_url:g,updated_at:new Date().toISOString()}).eq("id",e.id);if(a)throw console.error("Error updating room:",a),a}o({roomName:x,calendarUrl:g}),j(""),p("")}catch(e){console.error("Error in handleConnect:",e),w("Failed to connect. Please try again.")}};return(0,n.jsx)(k.Vq,{open:t,onOpenChange:a,children:(0,n.jsxs)(k.cZ,{className:"sm:max-w-[600px]",children:[(0,n.jsxs)(k.fK,{children:[(0,n.jsxs)(k.$N,{children:["Connect to ",s]}),(0,n.jsxs)(k.Be,{children:["Connect your property with ",s," using the iCal/ICS calendar URL"]})]}),(0,n.jsxs)("div",{className:"grid gap-4 py-4",children:[v?(0,n.jsxs)(L,{variant:"destructive",children:[(0,n.jsx)(P,{children:"Error"}),(0,n.jsx)(Z,{children:v})]}):(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"The calendar URL will be used to sync availability"}),(0,n.jsxs)("div",{className:"grid gap-2",children:[(0,n.jsx)(i._,{htmlFor:"room",children:"Room"}),(0,n.jsxs)(R.Ph,{value:x,onValueChange:p,disabled:c,children:[(0,n.jsx)(R.i4,{className:"w-full",children:(0,n.jsx)(R.ki,{placeholder:h.length>0?"Select a room":"No rooms available"})}),(0,n.jsx)(R.Bw,{children:h.length>0?h.map(e=>(0,n.jsx)(R.Ql,{value:e,children:e},e)):(0,n.jsx)(R.Ql,{value:"none",disabled:!0,children:"No available rooms found"})})]}),0===h.length&&(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"All rooms are already connected or no rooms exist."})]}),(0,n.jsxs)("div",{className:"grid gap-2",children:[(0,n.jsx)(i._,{htmlFor:"calendarUrl",children:"Calendar URL"}),(0,n.jsx)(O.I,{id:"calendarUrl",value:g,onChange:e=>{let t=e.target.value;j(t),u&&t&&!t.includes("booking.com")?w("Please enter a valid Booking.com calendar URL"):w(null)},placeholder:"Enter ".concat(s," calendar URL"),disabled:c,className:v?"border-red-500":""}),v?(0,n.jsx)("p",{className:"text-sm text-red-500",children:v}):(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"The calendar URL must be from booking.com domain and will be used to sync availability"})]}),(0,n.jsxs)(L,{children:[(0,n.jsx)(z.Z,{className:"h-4 w-4"}),(0,n.jsx)(P,{children:"Important"}),(0,n.jsxs)(Z,{children:["To get your ",s," calendar URL:",(0,n.jsxs)("ol",{className:"mt-2 ml-4 list-decimal",children:[(0,n.jsxs)("li",{children:["Log in to your ",s," account"]}),(0,n.jsx)("li",{children:"Go to Calendar Sync settings"}),(0,n.jsx)("li",{children:"Copy the iCal/ICS URL for your property"})]})]})]})]}),(0,n.jsxs)(k.cN,{children:[(0,n.jsx)(y.z,{variant:"outline",onClick:()=>a(!1),disabled:c,children:"Cancel"}),(0,n.jsx)(y.z,{onClick:N,disabled:c||!x||!g,children:c?"Processing...":d?"Add URL":"Connect"})]})]})})}var F=a(99154),D=a(31859),q=a(96762);function T(e){let{open:t,onOpenChange:a,onConnect:s,isLoading:l}=e,o=(0,E.createClientComponentClient)(),[c,d]=(0,r.useState)([]),[u,m]=(0,r.useState)(""),[h,f]=(0,r.useState)(""),[x,p]=(0,r.useState)(null);(0,r.useEffect)(()=>{async function e(){try{p(null),console.log("Fetching rooms...");let{data:e,error:t}=await o.from("rooms").select("id, name, agoda_calendar_url").is("agoda_calendar_url",null).order("name");if(t){console.error("Error fetching rooms:",t),p("Failed to fetch rooms");return}if(e&&e.length>0){console.log("Fetched rooms:",e);let t=e.map(e=>e.name);d(t)}else console.log("No available rooms found"),d([])}catch(e){console.error("Error in fetchRoomNames:",e),p("An unexpected error occurred")}}t&&e()},[t,o]),(0,r.useEffect)(()=>{t||(m(""),f(""))},[t]);let g=e=>e?e.includes("agoda.com")?(p(null),!0):(p("URL must be from agoda.com domain"),!1):(p("Calendar URL is required"),!1),j=async()=>{u&&h&&g(h)&&s({roomName:u,calendarUrl:h})};return(0,n.jsx)(k.Vq,{open:t,onOpenChange:a,children:(0,n.jsxs)(k.cZ,{className:"sm:max-w-[600px]",children:[(0,n.jsxs)(k.fK,{children:[(0,n.jsx)(k.$N,{children:"Connect to Agoda"}),(0,n.jsx)(k.Be,{children:"Connect your property with Agoda using the iCal/ICS calendar URL from your Agoda extranet"})]}),(0,n.jsxs)("div",{className:"grid gap-4 py-4",children:[x&&(0,n.jsxs)(L,{variant:"destructive",children:[(0,n.jsx)(P,{children:"Error"}),(0,n.jsx)(Z,{children:x})]}),(0,n.jsxs)("div",{className:"grid gap-2",children:[(0,n.jsx)(i._,{htmlFor:"room",children:"Room"}),(0,n.jsxs)(R.Ph,{value:u,onValueChange:m,disabled:l,children:[(0,n.jsx)(R.i4,{className:"w-full",children:(0,n.jsx)(R.ki,{placeholder:c.length>0?"Select a room":"No rooms available"})}),(0,n.jsx)(R.Bw,{children:c.length>0?c.map(e=>(0,n.jsx)(R.Ql,{value:e,children:e},e)):(0,n.jsx)(R.Ql,{value:"none",disabled:!0,children:"No available rooms found"})})]}),0===c.length&&!x&&(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"All rooms are already connected to Agoda or no rooms exist."})]}),(0,n.jsxs)("div",{className:"grid gap-2",children:[(0,n.jsx)(i._,{htmlFor:"calendarUrl",children:"Agoda Calendar URL"}),(0,n.jsx)(O.I,{id:"calendarUrl",value:h,onChange:e=>{let t=e.target.value;f(t),t?g(t):p(null)},placeholder:"https://agoda.com/calendar/...",disabled:l,className:x?"border-red-500":""}),x?(0,n.jsx)("p",{className:"text-sm text-red-500",children:x}):(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"The calendar URL must be from agoda.com domain and will be used to sync availability"})]}),(0,n.jsxs)(L,{children:[(0,n.jsx)(z.Z,{className:"h-4 w-4"}),(0,n.jsx)(P,{children:"Important"}),(0,n.jsxs)(Z,{children:["To get your Agoda calendar URL:",(0,n.jsxs)("ol",{className:"mt-2 ml-4 list-decimal",children:[(0,n.jsxs)("li",{children:["Log in to your ",(0,n.jsx)("a",{href:"https://ycs.agoda.com",target:"_blank",rel:"noopener noreferrer",className:"underline",children:"Agoda YCS Portal"})]}),(0,n.jsx)("li",{children:"Go to Calendar Sync settings"}),(0,n.jsx)("li",{children:"Copy the iCal/ICS URL for your property"}),(0,n.jsx)("li",{children:'Make sure the URL contains "agoda.com"'})]})]})]})]}),(0,n.jsxs)(k.cN,{children:[(0,n.jsx)(y.z,{variant:"outline",onClick:()=>a(!1),disabled:l,children:"Cancel"}),(0,n.jsx)(y.z,{onClick:j,disabled:l||!u||!h||!!x,children:l?"Processing...":"Connect to Agoda"})]})]})})}let V=e=>{try{let t=new URL(e),a=t.hostname;return"".concat(a).concat(t.pathname.slice(0,15),"...")}catch(t){return e.length>30?"".concat(e.slice(0,30),"..."):e}};function B(e){let{connections:t,onConnectionUpdate:a}=e,[l,o]=(0,r.useState)(!1),[i,c]=(0,r.useState)(!1),[d,u]=(0,r.useState)(null),[m,h]=(0,r.useState)(!1),{toast:f}=(0,D.pm)(),[x,g]=(0,r.useState)(!1),[E,U]=(0,r.useState)(!1),[A,L]=(0,r.useState)([]),[P,Z]=(0,r.useState)(null),[z,B]=(0,r.useState)(""),[Y,G]=(0,r.useState)(""),[Q,K]=(0,r.useState)([]);(0,r.useEffect)(()=>{let e=async()=>{try{let{data:e,error:n}=await F.O.from("channel_connections").select("channel_id, id");if(n)throw n;let r=t.map(t=>({...t,propertyCount:e.filter(e=>e.channel_id===t.id).length}));a(r)}catch(e){console.error("Error fetching property counts:",e)}};e()},[]);let $=async e=>{if(d){h(!0);try{let{data:n,error:r}=await F.O.from("rooms").select("id").eq("name",e.roomName).single();if(r)throw r;if(!n)throw Error("Room not found");let s={};if("1"===d.id?s={bookingdotcom_xml_url:e.calendarUrl}:"3"===d.id?s={airbnb_calendar_url:e.calendarUrl}:"2"===d.id?s={expedia_calendar_url:e.calendarUrl}:"4"===d.id?s={google_calendar_url:e.calendarUrl}:"6"===d.id?s={tripadvisor_calendar_url:e.calendarUrl}:"7"===d.id?s={gathern_calendar_url:e.calendarUrl}:"8"===d.id&&(s={tripcom_calendar_url:e.calendarUrl}),Object.keys(s).length>0){let{error:e}=await F.O.from("rooms").update({...s,updated_at:new Date().toISOString()}).eq("id",n.id);if(e)throw e}let{error:l}=await F.O.from("channel_connections").insert([{channel_id:d.id,channel_name:d.name,room_name:e.roomName,calendar_url:e.calendarUrl,status:"connected",last_sync:new Date().toISOString()}]);if(l)throw l;let{error:o}=await F.O.from("sync_logs").insert([{channel_id:d.id,channel_name:d.name,timestamp:new Date().toISOString(),status:"success",details:x?"Added new property for ".concat(d.name):"Connected to ".concat(d.name)}]);if(o)throw o;let i=t.map(e=>e.id===d.id?{...e,status:"connected",lastSync:new Date().toISOString(),propertyCount:x?e.propertyCount+1:1}:e);a(i),f({title:x?"Property added successfully":"Connected successfully",description:x?"Successfully added new property for ".concat(d.name):"Successfully connected to ".concat(d.name)}),window.location.reload()}catch(e){console.error("Error:",e),f({title:x?"Failed to add property":"Connection failed",description:"There was an error. Please try again.",variant:"destructive"})}finally{h(!1),o(!1),g(!1)}}},H=async e=>{let n=t.find(t=>t.id===e);if(n)try{let{data:r,error:s}=await F.O.from("channel_connections").select("*").eq("channel_id",e);if(s)throw s;L(r||[]),u(n),U(!0);let l=t.map(t=>t.id===e?{...t,propertyCount:r.length}:t);a(l)}catch(e){console.error("Error fetching properties:",e),f({title:"Error",description:"Failed to fetch properties",variant:"destructive"})}},M=async e=>{try{let{data:n,error:r}=await F.O.from("channel_connections").select("channel_id, room_name").eq("id",e).single();if(r)throw r;let{error:s}=await F.O.from("channel_connections").delete().eq("id",e);if(s)throw s;if(n){let e={};"1"===n.channel_id?e={bookingdotcom_xml_url:null}:"5"===n.channel_id&&(e={agoda_calendar_url:null});let{error:t}=await F.O.from("rooms").update(e).eq("name",n.room_name);if(t)throw t}L(t=>t.filter(t=>t.id!==e));let l=t.map(e=>e.id===(null==d?void 0:d.id)?{...e,propertyCount:e.propertyCount-1}:e);a(l),f({title:"Property deleted",description:"Property has been removed successfully"}),window.location.reload()}catch(e){console.error("Error deleting property:",e),f({title:"Error",description:"Failed to delete property",variant:"destructive"})}},X=e=>{navigator.clipboard.writeText(e),f({title:"Copied",description:"Calendar URL copied to clipboard"})},J=e=>{u(e),"5"===e.id?c(!0):o(!0)},W=async e=>{if(d){h(!0);try{let{data:n,error:r}=await F.O.from("rooms").select("id").eq("name",e.roomName).single();if(r)throw r;if(!n)throw Error("Room not found");let{error:s}=await F.O.from("rooms").update({agoda_calendar_url:e.calendarUrl,updated_at:new Date().toISOString()}).eq("id",n.id);if(s)throw s;let{error:l}=await F.O.from("channel_connections").insert([{channel_id:d.id,channel_name:d.name,room_name:e.roomName,calendar_url:e.calendarUrl,status:"connected",last_sync:new Date().toISOString()}]);if(l)throw l;let o=t.map(e=>e.id===d.id?{...e,status:"connected",lastSync:new Date().toISOString(),propertyCount:(e.propertyCount||0)+1}:e);a(o),c(!1),f({title:"Connected successfully",description:"Successfully connected Agoda for ".concat(e.roomName)})}catch(e){console.error("Error:",e),f({title:"Connection failed",description:"Failed to connect Agoda. Please try again.",variant:"destructive"})}finally{h(!1)}}},ee=async e=>{let t=A.find(t=>t.id===e);t&&(Z(e),B(t.room_name),G(t.calendar_url),await ea())},et=async e=>{try{if(h(!0),!z||!Y){f({title:"Validation Error",description:"Room name and Calendar URL are required",variant:"destructive"});return}console.log("Updating property:",{id:e,roomName:z,calendarUrl:Y});let{data:t,error:a}=await F.O.from("channel_connections").update({room_name:z,calendar_url:Y}).eq("id",e).select();if(a)throw console.error("Connection update error:",a),Error("Failed to update connection: ".concat(a.message));console.log("Connection updated:",t);let{data:n,error:r}=await F.O.from("rooms").select("id").eq("name",z).single();if(r)throw console.error("Room fetch error:",r),Error("Failed to fetch room: ".concat(r.message));if(!n)throw Error("Room not found");let s=(null==d?void 0:d.id)?({1:"bookingdotcom_xml_url",2:"expedia_calendar_url",3:"airbnb_calendar_url",4:"google_calendar_url",5:"agoda_calendar_url",6:"tripadvisor_calendar_url",7:"gathern_calendar_url",8:"tripcom_calendar_url",9:"hostels_calendar_url",10:"hotels_calendar_url"})[d.id]:null;if(!s)throw Error("Invalid channel selected");let{data:l,error:o}=await F.O.from("rooms").update({[s]:Y}).eq("id",n.id).select();if(o)throw console.error("Room update error:",o),Error("Failed to update room: ".concat(o.message));console.log("Room updated:",l);let i=A.map(t=>t.id===e?{...t,room_name:z,calendar_url:Y}:t);L(i),Z(null),B(""),G(""),f({title:"Success",description:"Property updated successfully"})}catch(e){console.error("Detailed error:",e),f({title:"Update Failed",description:e instanceof Error?"Error: ".concat(e.message):"Failed to update property. Please check the console for details.",variant:"destructive"})}finally{h(!1)}},ea=async()=>{try{let{data:e,error:t}=await F.O.from("rooms").select("name").order("name");if(t)throw t;K(e.map(e=>e.name))}catch(e){console.error("Error fetching rooms:",e)}};return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:t.map(e=>{let t=e.icon;return(0,n.jsx)(s.Zb,{className:(0,p.cn)("cursor-pointer hover:shadow-md transition-shadow","connected"===e.status&&"border-green-500"),onClick:()=>J(e),children:(0,n.jsxs)(s.aY,{className:"pt-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(t,{className:"h-5 w-5"})," ",(0,n.jsx)(s.ll,{children:e.name})]}),(0,n.jsx)(j.C,{variant:"connected"===e.status?"default":"secondary",children:"connected"===e.status?"Connected":"Not Connected"})]}),(0,n.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,n.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Last Sync: ",e.lastSync?S(e.lastSync):"Never"]}),(0,n.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Properties: ",e.propertyCount]}),"connected"===e.status&&(0,n.jsx)("div",{className:"flex justify-end mt-2",children:(0,n.jsx)(y.z,{variant:"ghost",size:"sm",onClick:t=>{t.stopPropagation(),H(e.id)},children:(0,n.jsx)(v.Z,{className:"h-4 w-4"})})})]})]})},e.id)})}),(0,n.jsx)(I,{open:l,onOpenChange:o,channelName:(null==d?void 0:d.name)||"",channelId:(null==d?void 0:d.id)||"",onConnect:$,isLoading:m,isBookingCom:(null==d?void 0:d.id)==="1"}),(0,n.jsx)(T,{open:i,onOpenChange:c,onConnect:W,isLoading:m}),(0,n.jsx)(k.Vq,{open:E,onOpenChange:U,children:(0,n.jsxs)(k.cZ,{className:"max-w-2xl",children:[(0,n.jsx)(k.fK,{children:(0,n.jsxs)(k.$N,{children:[null==d?void 0:d.name," Properties"]})}),(0,n.jsxs)(q.iA,{children:[(0,n.jsx)(q.xD,{children:(0,n.jsxs)(q.SC,{children:[(0,n.jsx)(q.ss,{children:"Room Name"}),(0,n.jsx)(q.ss,{children:"Calendar URL"}),(0,n.jsx)(q.ss,{children:"Last Sync"}),(0,n.jsx)(q.ss,{children:"Actions"})]})}),(0,n.jsx)(q.RM,{children:A.map(e=>(0,n.jsxs)(q.SC,{children:[(0,n.jsx)(q.pj,{children:P===e.id?(0,n.jsxs)(R.Ph,{value:z,onValueChange:B,children:[(0,n.jsx)(R.i4,{className:"w-full",children:(0,n.jsx)(R.ki,{children:z})}),(0,n.jsx)(R.Bw,{children:Q.map(e=>(0,n.jsx)(R.Ql,{value:e,children:e},e))})]}):e.room_name}),(0,n.jsx)(q.pj,{className:"max-w-[200px]",children:P===e.id?(0,n.jsx)(O.I,{value:Y,onChange:e=>G(e.target.value),className:"w-full"}):(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"truncate cursor-help",title:e.calendar_url,children:V(e.calendar_url)}),(0,n.jsx)(y.z,{variant:"ghost",size:"sm",onClick:()=>X(e.calendar_url),title:"Copy Calendar URL",className:"ml-auto",children:(0,n.jsx)(w.Z,{className:"h-4 w-4"})})]})}),(0,n.jsx)(q.pj,{children:S(e.last_sync)}),(0,n.jsx)(q.pj,{children:(0,n.jsxs)("div",{className:"flex space-x-2",children:[P===e.id?(0,n.jsx)(y.z,{variant:"ghost",size:"sm",onClick:()=>et(e.id),title:"Save Changes",disabled:m,children:m?(0,n.jsx)(N.Z,{className:"h-4 w-4 animate-spin"}):(0,n.jsx)(_.Z,{className:"h-4 w-4"})}):(0,n.jsx)(y.z,{variant:"ghost",size:"sm",onClick:()=>ee(e.id),title:"Edit Property",children:(0,n.jsx)(b.Z,{className:"h-4 w-4"})}),(0,n.jsx)(y.z,{variant:"ghost",size:"sm",onClick:()=>M(e.id),title:"Delete Property",disabled:P===e.id,children:(0,n.jsx)(C.Z,{className:"h-4 w-4"})})]})})]},e.id))})]})]})})]})}function Y(e){let{logs:t}=e;return(0,n.jsx)("div",{className:"space-y-4",children:t.map(e=>(0,n.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"font-medium",children:"Bokinn.app"===e.channel?(0,n.jsxs)("span",{className:"flex items-center",children:[(0,n.jsx)(c.Z,{className:"w-4 h-4 mr-2"}),e.channel]}):e.channel}),(0,n.jsx)("div",{className:"text-sm text-muted-foreground",children:e.details})]}),(0,n.jsxs)("div",{className:"text-right",children:[(0,n.jsx)("div",{className:"text-sm ".concat("success"===e.status?"text-green-600":"text-red-600"),children:e.status}),(0,n.jsx)("div",{className:"text-xs text-muted-foreground",children:S(e.timestamp)})]})]},e.id))})}let G=[{id:"0",name:"Bokinn.app",status:"disconnected",lastSync:null,propertyCount:0,icon:c.Z},{id:"1",name:"Booking.com",status:"disconnected",lastSync:null,propertyCount:0,icon:d.Z},{id:"2",name:"Expedia",status:"disconnected",lastSync:null,propertyCount:0,icon:d.Z},{id:"3",name:"Airbnb",status:"disconnected",lastSync:null,propertyCount:0,icon:d.Z},{id:"4",name:"Google Calendar",status:"disconnected",lastSync:null,propertyCount:0,icon:c.Z},{id:"5",name:"Agoda",status:"disconnected",lastSync:null,propertyCount:0,icon:d.Z},{id:"6",name:"TripAdvisor",status:"disconnected",lastSync:null,propertyCount:0,icon:d.Z},{id:"7",name:"Gathern",status:"disconnected",lastSync:null,propertyCount:0,icon:d.Z},{id:"8",name:"Trip.com",status:"disconnected",lastSync:null,propertyCount:0,icon:d.Z},{id:"9",name:"Hotels.com",status:"disconnected",lastSync:null,propertyCount:0,icon:d.Z},{id:"10",name:"Kayak.sa",status:"disconnected",lastSync:null,propertyCount:0,icon:d.Z}];function Q(){var e;let[t,a]=(0,r.useState)(!0),[c,d]=(0,r.useState)(G),[x,y]=(0,r.useState)([]),[j,v]=(0,r.useState)(!0),{toast:w}=(0,D.pm)(),[N,_]=(0,r.useState)(0),[b,C]=(0,r.useState)(!1),[k,E]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=async()=>{try{let{data:e,error:t}=await F.O.from("settings").select("*").single();if(t){if("PGRST116"===t.code){let{error:e}=await F.O.from("settings").insert([{auto_sync:!1,last_sync_time:null}]);if(e)throw e;a(!1)}else throw t}else e&&a(e.auto_sync)}catch(e){console.error("Error loading auto-sync settings:",e),w({title:"Error",description:"Failed to load auto-sync settings",variant:"destructive"})}};e()},[]);let R=async e=>{try{let{data:t,error:n}=await F.O.from("settings").select("id").single();if(n){if("PGRST116"===n.code){let{error:t}=await F.O.from("settings").insert([{auto_sync:e,last_sync_time:null}]);if(t)throw t}else throw n}else if(t){let{error:a}=await F.O.from("settings").update({auto_sync:e}).eq("id",t.id);if(a)throw a}a(e),w({title:e?"Auto-Sync Enabled":"Auto-Sync Disabled",description:e?"Channels will be synced automatically every 5 minutes":"Automatic synchronization has been disabled"}),e&&V()}catch(t){console.error("Error saving auto-sync settings:",t),w({title:"Error",description:"Failed to update auto-sync settings",variant:"destructive"}),a(!e)}},O=async()=>{try{let{data:e,error:t}=await F.O.from("channel_connections").select("channel_id, channel_name, status, last_sync").order("last_sync",{ascending:!1});if(t)throw t;let{data:a,error:n}=await F.O.from("rooms").select("id");if(n)throw n;let{data:r,error:s}=await F.O.from("channel_connections").select("channel_id").eq("status","connected");if(s)throw s;let l=null==r?void 0:r.reduce((e,t)=>(e[t.channel_id]=(e[t.channel_id]||0)+1,e),{});l["0"]=(null==a?void 0:a.length)||0;let o=null==e?void 0:e.reduce((e,t)=>((!e[t.channel_id]||new Date(t.last_sync)>new Date(e[t.channel_id]))&&(e[t.channel_id]=t.last_sync),e),{}),i=G.map(e=>{let t=(l[e.id]||0)>0;return{...e,status:t?"connected":"disconnected",lastSync:o[e.id]||null,propertyCount:l[e.id]||0}});d(i)}catch(e){console.error("Error fetching connection status:",e),w({title:"Error",description:"Failed to fetch connection status",variant:"destructive"})}},U=async()=>{try{let{data:e,error:t}=await F.O.from("sync_logs").select("*").order("timestamp",{ascending:!1}).limit(10);if(t)throw t;y((null==e?void 0:e.map(e=>({id:e.id,channel:e.channel_name,timestamp:e.timestamp,status:e.status,details:e.details})))||[])}catch(e){console.error("Error fetching sync logs:",e)}finally{v(!1)}};(0,r.useEffect)(()=>{let e=async()=>{await Promise.all([O(),U()])};e()},[]);let A=async e=>{d(e),U()},L=c.filter(e=>"connected"===e.status).length,P=c.reduce((e,t)=>e+t.propertyCount,0),Z=null===(e=x[0])||void 0===e?void 0:e.timestamp,z=Z?S(Z):"Never",[I="",q=""]="Never"===z?["Never",""]:(null==z?void 0:z.split(","))||["",""],T=async()=>{C(!0),_(0);try{let e=setInterval(()=>{_(t=>t>=100?(clearInterval(e),100):t+10)},500);await Promise.all([O(),U()]),w({title:"Sync Complete",description:"All channels have been synchronized successfully"})}catch(e){w({title:"Sync Failed",description:"There was an error during synchronization",variant:"destructive"})}finally{C(!1),_(0)}},V=async()=>{if(t&&!k){E(!0),_(0);try{let e=c.filter(e=>"connected"===e.status),t=e.length,a=0;for(let n of e)try{let{error:e}=await F.O.from("sync_logs").insert([{channel_id:n.id,channel_name:n.name,timestamp:new Date().toISOString(),status:"success",details:"Auto-sync started for ".concat(n.name)}]);if(e)throw e;a++,_(a/t*100)}catch(e){console.error("Error syncing ".concat(n.name,":"),e),await F.O.from("sync_logs").insert([{channel_id:n.id,channel_name:n.name,timestamp:new Date().toISOString(),status:"error",details:"Auto-sync failed for ".concat(n.name,": ").concat(e.message)}])}await Promise.all([O(),U()]),w({title:"Auto-Sync Complete",description:"Successfully synced ".concat(t," channels")})}catch(e){console.error("Error in auto-sync:",e),w({title:"Auto-Sync Failed",description:"There was an error during synchronization",variant:"destructive"})}finally{E(!1),_(0)}}};return(!function(e,t){let a=(0,r.useRef)(e);(0,r.useEffect)(()=>{a.current=e},[e]),(0,r.useEffect)(()=>{if(null===t)return;let e=setInterval(()=>a.current(),t);return()=>clearInterval(e)},[t])}(V,t?3e5:null),(0,r.useEffect)(()=>{t&&V()},[t]),j)?(0,n.jsx)("div",{className:"space-y-6",children:(0,n.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)(s.Zb,{children:[(0,n.jsx)(s.Ol,{className:"pb-2",children:(0,n.jsx)(f.O,{className:"h-4 w-[150px]"})}),(0,n.jsxs)(s.aY,{children:[(0,n.jsx)(f.O,{className:"h-8 w-[100px]"}),(0,n.jsx)(f.O,{className:"h-4 w-[120px] mt-2"})]})]},t))})}):(0,n.jsxs)("div",{className:"space-y-6",children:[(b||k)&&(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)(g,{value:N,className:"h-2"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground mt-2",children:k?"Auto-syncing channels...":"Synchronizing channels..."})]}),(0,n.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,n.jsxs)(s.Zb,{className:"hover:shadow-lg transition-shadow",children:[(0,n.jsxs)(s.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,n.jsx)(s.ll,{className:"text-sm font-medium",children:"Connected Channels"}),(0,n.jsx)(u.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,n.jsxs)(s.aY,{children:[(0,n.jsx)("div",{className:"text-2xl font-bold",children:L}),(0,n.jsxs)("p",{className:"text-xs text-muted-foreground",children:[P," properties synchronized"]})]})]}),(0,n.jsxs)(s.Zb,{className:"hover:shadow-lg transition-shadow",children:[(0,n.jsxs)(s.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,n.jsx)(s.ll,{className:"text-sm font-medium",children:"Last Sync"}),(0,n.jsx)(m.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,n.jsxs)(s.aY,{children:[(0,n.jsx)("div",{className:"text-2xl font-bold",children:q||"Never"}),(0,n.jsx)("p",{className:"text-xs text-muted-foreground",children:I})]})]}),(0,n.jsxs)(s.Zb,{className:(0,p.cn)("hover:shadow-lg transition-shadow",!t&&"border-orange-500"),children:[(0,n.jsxs)(s.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,n.jsx)(s.ll,{className:"text-sm font-medium",children:"Auto Sync"}),(0,n.jsx)(h.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,n.jsxs)(s.aY,{children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(o.r,{id:"auto-sync",checked:t,onCheckedChange:R}),(0,n.jsx)(i._,{htmlFor:"auto-sync",className:"text-sm",children:t?"Enabled":"Disabled"})]}),!t&&(0,n.jsx)("p",{className:"text-xs text-orange-500 mt-2",children:"Auto-sync is disabled. Enable to sync every 5 minutes."})]})]}),(0,n.jsxs)(s.Zb,{className:"hover:shadow-lg transition-shadow cursor-pointer",onClick:T,role:"button",tabIndex:0,children:[(0,n.jsxs)(s.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,n.jsx)(s.ll,{className:"text-sm font-medium",children:"Manual Sync"}),(0,n.jsx)("div",{className:"h-4 w-4 rounded-full ".concat(b?"animate-pulse bg-blue-500":"bg-green-500")})]}),(0,n.jsx)(s.aY,{children:(0,n.jsx)("div",{className:"text-sm font-medium",children:b?"Syncing...":"Click to sync"})})]})]}),(0,n.jsxs)(l.mQ,{defaultValue:"channels",className:"space-y-4",children:[(0,n.jsxs)(l.dr,{className:"grid w-full grid-cols-2 lg:w-[400px]",children:[(0,n.jsx)(l.SP,{value:"channels",children:"Connected Channels"}),(0,n.jsx)(l.SP,{value:"history",children:"Sync History"})]}),(0,n.jsx)(l.nU,{value:"channels",children:(0,n.jsx)(B,{connections:c,onConnectionUpdate:A})}),(0,n.jsx)(l.nU,{value:"history",children:(0,n.jsx)(Y,{logs:x})})]})]})}},43626:function(e,t,a){"use strict";a.d(t,{$N:function(){return f},Be:function(){return x},Vq:function(){return i},cN:function(){return h},cZ:function(){return u},fK:function(){return m}});var n=a(9268),r=a(86006),s=a(29040),l=a(18178),o=a(26602);let i=s.fC;s.xz;let c=s.h_;s.x8;let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(s.aV,{ref:t,className:(0,o.cn)("fixed inset-0 z-50 bg-black/50 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r})});d.displayName=s.aV.displayName;let u=r.forwardRef((e,t)=>{let{className:a,children:r,...i}=e;return(0,n.jsxs)(c,{children:[(0,n.jsx)(d,{}),(0,n.jsxs)(s.VY,{ref:t,className:(0,o.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...i,children:[r,(0,n.jsxs)(s.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,n.jsx)(l.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=s.VY.displayName;let m=e=>{let{className:t,...a}=e;return(0,n.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};m.displayName="DialogHeader";let h=e=>{let{className:t,...a}=e;return(0,n.jsx)("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};h.displayName="DialogFooter";let f=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(s.Dx,{ref:t,className:(0,o.cn)("text-lg font-semibold leading-none tracking-tight",a),...r})});f.displayName=s.Dx.displayName;let x=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(s.dk,{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",a),...r})});x.displayName=s.dk.displayName},13583:function(e,t,a){"use strict";a.d(t,{_:function(){return c}});var n=a(9268),r=a(86006),s=a(10211),l=a(78917),o=a(26602);let i=(0,l.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(s.f,{ref:t,className:(0,o.cn)(i(),a),...r})});c.displayName=s.f.displayName},31210:function(e,t,a){"use strict";a.d(t,{r:function(){return o}});var n=a(9268),r=a(86006),s=a(24300),l=a(26602);let o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(s.fC,{className:(0,l.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",a),...r,ref:t,children:(0,n.jsx)(s.bU,{className:(0,l.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});o.displayName=s.fC.displayName}},function(e){e.O(0,[222,795,266,946,69,77,441,79,667,488,744],function(){return e(e.s=82906)}),_N_E=e.O()}]);